---
import {
  transformerMetaHighlight,
  transformerNotationFocus,
  transformerNotationDiff,
} from '@shikijs/transformers'
import { Code } from 'astro:components'
import type {
  BuiltinLanguage,
  LanguageRegistration,
  SpecialLanguage,
} from 'shiki'

interface Props {
  code: string
  language: BuiltinLanguage | SpecialLanguage | LanguageRegistration
  highlightedLines: string
  filePath: string
  icon: string
}

const props = Astro.props
const code = props.code
  .split('\n')
  .map((line, i) => `${i + 1}    ${line}`)
  .join('\n')
---

<!-- TODO: add the file name/tabs look -->
<Code
  code={code}
  lang={props.language}
  meta={props.highlightedLines}
  transformers={[
    transformerMetaHighlight(),
    transformerNotationFocus(),
    transformerNotationDiff(),
    {
      line(node) {
        // @ts-expect-error
        this.addClassToHast(node.children[0], 'line-number')
      },
    },
  ]}
/>

<style is:global>
  /* TODO: Update this to line highlight correctly */
  .highlighted {
    background-color: rgba(248, 248, 250, 0.25);
    width: max-content !important;
    border-left: 4px solid rgb(249, 87, 56);
  }

  pre.has-focused .line:not(.focused) {
    filter: blur(1px);
  }

  /* TODO: Update this for line number styles */
  .line-number {
  }
</style>
