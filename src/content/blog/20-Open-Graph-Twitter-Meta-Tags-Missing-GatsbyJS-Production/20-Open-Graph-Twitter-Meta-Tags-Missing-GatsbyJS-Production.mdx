---
title: "Open Graph & Twitter Meta Tags Missing from GatsbyJS Website in Production"
date: "2021-01-18"
tags: ["GatsbyJS"]
slug: open-graph-twitter-meta-tags-missing-gatsbyjs-website-production
image: ./20-Open-Graph-Twitter-Meta-Tags-Missing-GatsbyJS-Production.png
id: 20
---

Recently when trying to get Twitter Cards working on my website I realised that the Meta Tags for Open Graph and Twitter was not being added to my GatsbyJS website when built and served in production.

I done some extensive Googling to try and resolve the issue without a great deal of luck. After playing around with the meta tags in my [SEO file](https://github.com/conermurphy/conermurphy.com/blob/4c33549d62f65e88ee75f4af44e43675b34c4b9e/src/components/SEO.js) I decided they weren't the issue as they had the same configuration as other websites that had working Twitter Cards.

The one aspect of this problem that confused things further for me was that all the required meta tags where present when you inspected the HTML of the website but then I came across [this post](https://twittercommunity.com/t/card-error-unable-to-render-or-no-image-read-this-first/62736) which suggested trying to emulate how the Twitterbot will crawl your website for the required information and seeing if all of the meta tags where pesent then.

If you want to try this yourself, use the following command in your terminal and replace the url with the page you wish to crawl:

```
curl -v -A Twitterbot <url>
```

This should return the HTML for your page, allowing you to inspect it and see if the meta tags required where present, in my case they were not.

BINGO! I had found the issue but that's only half the battle, now onto fixing it.

## The Solution

As a quick side note if you are facing this issue and want a quicker feedback loop then pushing the repo, waiting for the site to rebuild and then running the curl command above. What you can do is build your webiste using `Gatsby Build` and then checking the `index.html` file inside of your public folder. If this file includes all the required meta tags then you should be good to go.

Anyway onto fixing the issue.

The reason I could see the meta tags when inspecting the website but the Twitterbot could not when crawling it is because the meta tags where being added in by JavaScript on runtime rather than being included in the staic version of the website on build and as the Twitterbot fetches the version from the server and doesn't execute the JavaScript the meta tags weren't being added in on runtime like they were when a user visits the page.

What further added to my confusion was that the file injecting my meta tags (my SEO component which you can [learn about implementing here.](https://conermurphy.com/blog/adding-open-graph-twitter-meta-tags-gatsbyjs)) had no issues causing this problem so the issue had to be somewhere else in my code.

After some digging about in my code for a bit I came across a hacked solution to a problem I faced for another aspect of my website, the Cookie Banner.

When I was implmenting the Cookie Banner for my website I had this constant issue of it not rendering properly when running `Gatsby Build` but it being fine in `Gatsby Develop` so what I did was add the below code to my `Layout.js`:

```JavaScript
if (typeof window === 'undefined') {
    return <></>;
  }
```

Now, at the time I added that code it fixed my Cookie Banner issue which was brillant but what I didn't see at the time was the unintended side-effects caused by this change, as the `Layout.js` file wrapped every page in my website, these 3 lines of code caused my website to not render correctly server side and instead moving the rendering to runtime.

After removing this code and finding a proper solution to my Cookie Banner issue, my meta tags started showing up again in the build version of my website and my Twitter Cards where working again.

## Sumamry

If you're having the issue of your meta tags not beind included in your statically built files in prodiction then make sure you're defintely rednering out all the pages and not shortcircuting the server render like I was above.

Also, on a side note for myself; avoid doing hacky fixes as you never know what problems it will cause down the road!
